(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{28:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),s=n(20),r=n.n(s),i=(n(28),n(15)),o=n(2),u=n(22),l=n(4),d=n(6),j=n.n(d),b=window.location.href.includes("localhost")?"http://localhost:8000":"https://ak-messenger.herokuapp.com",m=window.location.href.includes("localhost")?"ws://localhost:8000":"wss://ak-messenger.herokuapp.com",h=(window.location.href.includes("localhost:3000"),j.a.get("csrftoken"),n(0)),O=Object(a.createContext)(null);function f(e){var t=Object(o.g)().room,n=new WebSocket("".concat(m,"/ws/chat/").concat(t,"/"));return Object(h.jsx)(O.Provider,{value:{socket:n},children:e.children})}var p=n(5),v=n.n(p),x=n(10);function g(e){var t=Object(a.useState)(),n=Object(l.a)(t,2),c=n[0],s=n[1];return Object(a.useEffect)((function(){function t(){return(t=Object(x.a)(v.a.mark((function t(){var n,a;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(b,"/users/").concat(e.userId),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include"});case 2:return n=t.sent,t.next=5,n.json();case 5:a=t.sent,s(a);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e.userId]),Object(h.jsxs)("div",{className:"chat-user",children:[Object(h.jsx)("img",{className:"avatar",src:null===c||void 0===c?void 0:c.avatar,alt:"avatar"}),null===c||void 0===c?void 0:c.full_name]})}var N=n(23),w=Object(a.createContext)({});function C(e){var t=Object(a.useState)({id:0,username:"",full_name:"",avatar:""}),n=Object(l.a)(t,2),c=n[0],s=n[1];return Object(a.useEffect)((function(){function e(){return(e=Object(x.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/current-user/"),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include"});case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,s(n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(h.jsx)(w.Provider,{value:Object(N.a)({},c),children:e.children})}var k=n.p+"static/media/send.d8a7ff16.svg";function S(){var e,t=(e="user_id",new URLSearchParams(window.location.search).get(e)),n=Object(a.useContext)(O).socket,c=Object(a.useContext)(w).username,s=Object(a.useState)([]),r=Object(l.a)(s,2),i=r[0],o=r[1],d=Object(a.useState)(""),j=Object(l.a)(d,2),b=j[0],m=j[1],f=Object(a.useRef)(null);Object(a.useEffect)((function(){var e=f.current;null===e||void 0===e||e.scrollTo(0,e.scrollHeight)}),[i]),Object(a.useEffect)((function(){return n.onopen=function(){n.send(JSON.stringify({command:"fetch_messages"}))},n.onmessage=function(e){var t=JSON.parse(e.data);"messages"===t.message.command?o(t.message.messages):"message"===t.message.command&&o((function(e){return[].concat(Object(u.a)(e),[t.message.message])}))},n.onclose=function(e){console.error("Chat socket closed unexpectedly")},function(){return null===n||void 0===n?void 0:n.close()}}),[n]);return Object(h.jsxs)("div",{className:"chat",children:[Object(h.jsx)(g,{userId:t}),Object(h.jsx)("div",{className:"chat-room",ref:f,children:null===i||void 0===i?void 0:i.map((function(e){return c===e.author?Object(h.jsxs)("div",{className:"message sender",children:[Object(h.jsx)("div",{className:"text",children:e.content}),Object(h.jsx)("small",{className:"timestamp",children:T(e.timestamp)})]},e.id):Object(h.jsxs)("div",{className:"message receiver",children:[Object(h.jsx)("div",{className:"text",children:e.content}),Object(h.jsx)("small",{className:"timestamp",children:T(e.timestamp)})]},e.id)}))}),Object(h.jsxs)("div",{className:"chat-message",children:[Object(h.jsx)("input",{className:"chat-message-input",type:"text",value:b,onChange:function(e){return m(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&(n.send(JSON.stringify({message:b,command:"new_message"})),m(""))}}),Object(h.jsx)("button",{className:"chat-message-button",onClick:function(){n.send(JSON.stringify({message:b,command:"new_message"})),m("")},children:Object(h.jsx)("img",{src:k,alt:"send"})})]})]})}function T(e){var t=Math.round(((new Date).getTime()-new Date(e).getTime())/6e4);return t<1?"Just now":t<60&&t>=1?"".concat(t," minutes ago"):t<1440&&t>=60?"".concat(Math.round(t/60)," hours ago"):t<44640&&t>=1440?"".concat(Math.round(t/1440)," days ago"):"".concat(new Date(e))}function y(){var e=Object(a.useState)([]),t=Object(l.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){function e(){return(e=Object(x.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/contacts/"),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include"});case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,c(n.contacts);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(h.jsx)("div",{children:null===n||void 0===n?void 0:n.map((function(e){return Object(h.jsxs)(i.b,{className:"sidebar-user contact",to:"/chat/".concat(e.room,"?user_id=").concat(e.id),children:[Object(h.jsx)("img",{className:"avatar",src:e.avatar,alt:"avatar"}),Object(h.jsxs)("div",{className:"text",children:[Object(h.jsx)("div",{className:"name",children:e.full_name}),Object(h.jsx)("div",{className:"last-message",children:"Last message"})]})]},e.id)}))})}var F=n.p+"static/media/plus.c9092a12.svg";function _(){var e=Object(a.useState)([]),t=Object(l.a)(e,2),n=t[0],c=t[1];Object(a.useEffect)((function(){function e(){return(e=Object(x.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/users/"),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include"});case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,c(n.users);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var s=function(){var e=Object(x.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(b,"/add-contact/"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include",body:JSON.stringify({user_id:t})});case 2:window.location.reload();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(h.jsx)("div",{children:null===n||void 0===n?void 0:n.map((function(e){return Object(h.jsxs)("div",{className:"sidebar-user",children:[Object(h.jsx)("img",{className:"avatar",src:e.avatar,alt:"avatar"}),e.full_name,Object(h.jsx)("button",{className:"add-contact-button",onClick:function(){return s(e.id)},children:Object(h.jsx)("img",{src:F,alt:"add-contact"})})]},e.id)}))})}function E(){var e=Object(a.useContext)(w),t=e.full_name,n=e.avatar,c=Object(a.useState)("CONTACTS"),s=Object(l.a)(c,2),r=s[0],i=s[1];return Object(h.jsxs)("div",{className:"sidebar",children:[Object(h.jsxs)("div",{className:"current-user",children:[Object(h.jsx)("img",{src:n,alt:"user-avatar"}),t]}),"CONTACTS"===r&&Object(h.jsxs)(a.Fragment,{children:[Object(h.jsx)(y,{}),Object(h.jsx)("button",{className:"sidebar-button",onClick:function(){return i("ADD_CONTACT")},children:"Add contacts"})]}),"ADD_CONTACT"===r&&Object(h.jsxs)(a.Fragment,{children:[Object(h.jsx)(_,{}),Object(h.jsx)("button",{className:"sidebar-button",onClick:function(){return i("CONTACTS")},children:"Back to contacts"})]})]})}function D(){var e=Object(a.useState)(""),t=Object(l.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(""),r=Object(l.a)(s,2),i=r[0],u=r[1],d=Object(a.useState)(""),m=Object(l.a)(d,2),O=m[0],f=m[1],p=Object(a.useState)(""),g=Object(l.a)(p,2),N=g[0],w=g[1],C=Object(o.f)(),k=function(){var e=Object(x.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n&&i&&O&&N){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,fetch("".concat(b,"/register/"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include",body:JSON.stringify({email:n,first_name:i,last_name:O,password:N})});case 5:C.push("/chat"),window.location.reload();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(h.jsxs)("form",{onSubmit:k,className:"register-form",children:[Object(h.jsxs)("div",{className:"register-input",children:[Object(h.jsx)("label",{htmlFor:"email",children:"Epost"}),Object(h.jsx)("input",{id:"email",value:n,onChange:function(e){return c(e.target.value)}})]}),Object(h.jsxs)("div",{className:"register-input",children:[Object(h.jsx)("label",{htmlFor:"email",children:"Fornavn"}),Object(h.jsx)("input",{id:"firstName",value:i,onChange:function(e){return u(e.target.value)}})]}),Object(h.jsxs)("div",{className:"register-input",children:[Object(h.jsx)("label",{htmlFor:"email",children:"Etternavn"}),Object(h.jsx)("input",{id:"lastName",value:O,onChange:function(e){return f(e.target.value)}})]}),Object(h.jsxs)("div",{className:"register-input",children:[Object(h.jsx)("label",{htmlFor:"email",children:"Passord"}),Object(h.jsx)("input",{id:"password",type:"password",value:N,onChange:function(e){return w(e.target.value)}})]}),Object(h.jsx)("button",{type:"submit",children:"Registrer"})]})}function J(){return Object(h.jsx)(i.a,{children:Object(h.jsx)(C,{children:Object(h.jsx)("div",{className:"app",children:Object(h.jsxs)(o.c,{children:[Object(h.jsxs)(o.a,{path:"/chat",children:[Object(h.jsx)(E,{}),Object(h.jsx)(o.c,{children:Object(h.jsx)(o.a,{path:"/chat/:room",children:Object(h.jsx)(f,{children:Object(h.jsx)(S,{})})})})]}),Object(h.jsx)(o.a,{path:"/",children:Object(h.jsx)(D,{})})]})})})})}var R=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),s(e),r(e)}))};r.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(J,{})}),document.getElementById("root")),R()}},[[39,1,2]]]);
//# sourceMappingURL=main.a4b46bbd.chunk.js.map