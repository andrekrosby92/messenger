(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{28:function(e,t,n){},39:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n.n(c),s=n(20),r=n.n(s),o=(n(28),n(15)),i=n(2),u=n(22),l=n(5),d=n(9),j=n.n(d),m=window.location.href.includes("localhost")?"http://localhost:8000":"https://ak-messenger.herokuapp.com",h=window.location.href.includes("localhost")?"ws://localhost:8000":"wss://ak-messenger.herokuapp.com",b=(window.location.href.includes("localhost:3000"),j.a.get("csrftoken"),n(1)),f=Object(c.createContext)(null);function O(e){var t=Object(i.f)().room,n=new WebSocket("".concat(h,"/ws/chat/").concat(t,"/"));return Object(b.jsx)(f.Provider,{value:{socket:n},children:e.children})}var v=n(4),p=n.n(v),x=n(10);function g(e){var t=Object(c.useState)(),n=Object(l.a)(t,2),a=n[0],s=n[1];return Object(c.useEffect)((function(){function t(){return(t=Object(x.a)(p.a.mark((function t(){var n,c;return p.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(m,"/users/").concat(e.userId),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include"});case 2:return n=t.sent,t.next=5,n.json();case 5:c=t.sent,s(c);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e.userId]),Object(b.jsxs)("div",{className:"chat-user",children:[Object(b.jsx)("img",{className:"avatar",src:null===a||void 0===a?void 0:a.avatar,alt:"avatar"}),null===a||void 0===a?void 0:a.full_name]})}var N=n(23),C=Object(c.createContext)({});function w(e){var t=Object(c.useState)({id:0,username:"",full_name:"",avatar:""}),n=Object(l.a)(t,2),a=n[0],s=n[1];return Object(c.useEffect)((function(){function e(){return(e=Object(x.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/current-user/"),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include"});case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,s(n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(b.jsx)(C.Provider,{value:Object(N.a)({},a),children:e.children})}var k=n.p+"static/media/send.d8a7ff16.svg";function T(){var e,t=(e="user_id",new URLSearchParams(window.location.search).get(e)),n=Object(c.useContext)(f).socket,a=Object(c.useContext)(C).username,s=Object(c.useState)([]),r=Object(l.a)(s,2),o=r[0],i=r[1],d=Object(c.useState)(""),j=Object(l.a)(d,2),m=j[0],h=j[1],O=Object(c.useRef)(null);Object(c.useEffect)((function(){var e=O.current;null===e||void 0===e||e.scrollTo(0,e.scrollHeight)}),[o]),Object(c.useEffect)((function(){return n.onopen=function(){n.send(JSON.stringify({command:"fetch_messages"}))},n.onmessage=function(e){var t=JSON.parse(e.data);"messages"===t.message.command?i(t.message.messages):"message"===t.message.command&&i((function(e){return[].concat(Object(u.a)(e),[t.message.message])}))},n.onclose=function(e){console.error("Chat socket closed unexpectedly")},function(){return null===n||void 0===n?void 0:n.close()}}),[n]);return Object(b.jsxs)("div",{className:"chat",children:[Object(b.jsx)(g,{userId:t}),Object(b.jsx)("div",{className:"chat-room",ref:O,children:null===o||void 0===o?void 0:o.map((function(e){return a===e.author?Object(b.jsxs)("div",{className:"message sender",children:[Object(b.jsx)("div",{className:"text",children:e.content}),Object(b.jsx)("small",{className:"timestamp",children:S(e.timestamp)})]},e.id):Object(b.jsxs)("div",{className:"message receiver",children:[Object(b.jsx)("div",{className:"text",children:e.content}),Object(b.jsx)("small",{className:"timestamp",children:S(e.timestamp)})]},e.id)}))}),Object(b.jsxs)("div",{className:"chat-message",children:[Object(b.jsx)("input",{className:"chat-message-input",type:"text",value:m,onChange:function(e){return h(e.target.value)}}),Object(b.jsx)("button",{className:"chat-message-button",onClick:function(){n.send(JSON.stringify({message:m,command:"new_message"})),h("")},children:Object(b.jsx)("img",{src:k,alt:"send"})})]})]})}function S(e){var t=Math.round(((new Date).getTime()-new Date(e).getTime())/6e4);return t<1?"Just now":t<60&&t>=1?"".concat(t," minutes ago"):t<1440&&t>=60?"".concat(Math.round(t/60)," hours ago"):t<44640&&t>=1440?"".concat(Math.round(t/1440)," days ago"):"".concat(new Date(e))}function y(){var e=Object(c.useState)([]),t=Object(l.a)(e,2),n=t[0],a=t[1];return Object(c.useEffect)((function(){function e(){return(e=Object(x.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/contacts/"),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include"});case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,a(n.contacts);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(b.jsx)("div",{children:null===n||void 0===n?void 0:n.map((function(e){return Object(b.jsxs)(o.b,{className:"sidebar-user contact",to:"/chat/".concat(e.room,"?user_id=").concat(e.id),children:[Object(b.jsx)("img",{className:"avatar",src:e.avatar,alt:"avatar"}),Object(b.jsxs)("div",{className:"text",children:[Object(b.jsx)("div",{className:"name",children:e.full_name}),Object(b.jsx)("div",{className:"last-message",children:"Last message"})]})]},e.id)}))})}var _=n.p+"static/media/plus.c9092a12.svg";function E(){var e=Object(c.useState)([]),t=Object(l.a)(e,2),n=t[0],a=t[1];Object(c.useEffect)((function(){function e(){return(e=Object(x.a)(p.a.mark((function e(){var t,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/users/"),{method:"GET",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include"});case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,a(n.users);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var s=function(){var e=Object(x.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(m,"/add-contact/"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":j.a.get("csrftoken")||""},credentials:"include",body:JSON.stringify({user_id:t})});case 2:window.location.reload();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(b.jsx)("div",{children:null===n||void 0===n?void 0:n.map((function(e){return Object(b.jsxs)("div",{className:"sidebar-user",children:[Object(b.jsx)("img",{className:"avatar",src:e.avatar,alt:"avatar"}),e.full_name,Object(b.jsx)("button",{className:"add-contact-button",onClick:function(){return s(e.id)},children:Object(b.jsx)("img",{src:_,alt:"add-contact"})})]},e.id)}))})}function F(){var e=Object(c.useContext)(C),t=e.full_name,n=e.avatar,a=Object(c.useState)("CONTACTS"),s=Object(l.a)(a,2),r=s[0],o=s[1];return Object(b.jsxs)("div",{className:"sidebar",children:[Object(b.jsxs)("div",{className:"current-user",children:[Object(b.jsx)("img",{src:n,alt:"user-avatar"}),t]}),"CONTACTS"===r&&Object(b.jsxs)(c.Fragment,{children:[Object(b.jsx)(y,{}),Object(b.jsx)("button",{className:"sidebar-button",onClick:function(){return o("ADD_CONTACT")},children:"Add contacts"})]}),"ADD_CONTACT"===r&&Object(b.jsxs)(c.Fragment,{children:[Object(b.jsx)(E,{}),Object(b.jsx)("button",{className:"sidebar-button",onClick:function(){return o("CONTACTS")},children:"Back to contacts"})]})]})}function A(){return Object(b.jsx)(o.a,{children:Object(b.jsx)(w,{children:Object(b.jsxs)("div",{className:"app",children:[Object(b.jsx)(F,{}),Object(b.jsx)(i.c,{children:Object(b.jsx)(i.a,{path:"/chat/:room",children:Object(b.jsx)(O,{children:Object(b.jsx)(T,{})})})})]})})})}var D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,40)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),s(e),r(e)}))};r.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(A,{})}),document.getElementById("root")),D()}},[[39,1,2]]]);
//# sourceMappingURL=main.97ee67ec.chunk.js.map